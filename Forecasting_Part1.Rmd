---
title: "Forecasting Part 1"
author: "Kristen Trinh, Jinxi Liu"
date: '2023-04-04'
output: pdf_document
---

```{r}
#load library
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(zoo)
library(kableExtra)
library(readxl)
```

```{r}
load_data<- read_excel(path="./data/load.xlsx",col_names=TRUE)
head(load_data)
```

```{r}
#average 24 hours data and combining with date
load_data_new<-load_data %>%
  select(h1:h24)
daily_load_mean<-rowMeans(load_data_new,c(3,26))
as.data.frame(daily_load_mean)

load_data_date<-load_data %>%
  select("date")

#creating variable to save this -kristen
daily_load_mean_date_df<-cbind.data.frame(load_data_date,daily_load_mean)

#filter to only 2005-2009
daily_load_mean_data_df_2009<-filter(daily_load_mean_date_df, date <= "2009-12-31")
```

```{r}
#transfer to times series
#ts_load_hourly <- msts(daily_load_mean, 
                            #seasonal.periods =c(24,168,8766),
                            #start=c(2005,1,1))
#ts_load_daily <- msts(daily_load_mean, 
                          # seasonal.periods =c(7,365.25),
                          # start=c(2005,1,1))
```

```{r}
#decomposing for both time series
## ts_load_daily %>% mstl() = mstl(ts_load_daily)
#ts_load_daily %>% mstl() %>%
 # autoplot()

#ts_load_hourly %>% mstl() %>%
 # autoplot()
```

```{r}
#creating time series object for just 2005-2009 data

ts_load_daily_2009 <- msts(daily_load_mean_data_df_2009$daily_load_mean, 
                          seasonal.periods =c(7,365.25),
                          start=c(2005,1,1))
```

```{r}
#decomposing data
ts_load_daily_2009 %>% mstl() %>%
  autoplot()

deseas_ts_load_daily_2009<-mstl(ts_load_daily_2009)
plot(deseas_ts_load_daily_2009)
```



```{r}
#create a subset for training purpose
n_for = 365
ts_load_daily_2009_train <- subset(ts_load_daily_2009,
                                   end = length(ts_load_daily_2009)-n_for)

#create a subset for testing purpose
ts_load_daily_2009_test <- subset(ts_load_daily_2009,
                                   start = length(ts_load_daily_2009)-n_for)

autoplot(ts_load_daily_2009_train)
autoplot(ts_load_daily_2009_test)
```


```{r}
#model 1: ARIMA, non-seasonal


#Forecast with ARIMA fit
#also need to specify h for fourier terms
ARIMA_Four_for <- forecast(ARIMA_Four_fit,
                           xreg=fourier(ts_act_power_daily_train,
                                        K=c(2,12),
                                        h=365),
                           h=365
                           ) 


deseas_ARIMA_load_daily_2009<-auto.arima(deseas_ts_load_daily_2009[,2], 
                                         )

deseas_ARIMA_forecast_load_daily_2009<-forecast(object=deseas_ARIMA_load_daily_2009, h=365)
plot(deseas_ARIMA_forecast_load_daily_2009)

```

